apiVersion: apps/v1
kind: Deployment
metadata:
  name: activescale
  namespace: ns-observability
  labels:
    thinq.service: activescale
    app: activescale
    workload: metrics-adapter
spec:
  replicas: 2
  selector:
    matchLabels:
      app: activescale
      workload: metrics-adapter
  template:
    metadata:
      labels:
        thinq.service: activescale
        app: activescale
        workload: metrics-adapter
    spec:
      serviceAccountName: activescale
      nodeSelector:
        nodepool: np-cluster-arm64
      containers:
        - name: activescale
          image: ghcr.io/anyflow/activescale:latest
          args:
            - --secure-port=6443
            - --cert-dir=/var/run/serving-cert
          envFrom:
            - configMapRef:
                name: activescale-config
          ports:
            - name: https
              containerPort: 6443
            - name: envoy-grpc
              containerPort: 9000
          volumeMounts:
            - name: serving-cert
              mountPath: /var/run/serving-cert
      volumes:
        - name: serving-cert
          emptyDir: {} # dev/POC용 (prod에서는 cert-manager secret 권장)
